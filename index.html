<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Virtu√°lis bej√°r√°s ‚Äì Admin drag & drop</title>
  <script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #alaprajz-container { position: relative; width: 800px; }
    #alaprajz-container img { width: 800px; display: block; }
    .hotspot {
      position: absolute; width: 20px; height: 20px;
      background: red; border-radius: 50%; cursor: pointer;
      border: 2px solid white;
    }
    .hotspot.admin { cursor: grab; }

    /* üîπ Panor√°mak√©p 3:2 ar√°nyban */
    #panorama {
      width: 100%;
      aspect-ratio: 3 / 2;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h2>Virtu√°lis bej√°r√°s</h2>

<!-- Admin k√≥d bek√©r√©s -->
<label for="adminkod">Admin k√≥d:</label>
<input type="password" id="adminkod" placeholder="√çrd be a k√≥dot">
<button onclick="checkAdmin()">Bel√©p√©s</button>
<span id="adminstatus" style="margin-left:10px;color:green;"></span>

<!-- Leg√∂rd√ºl≈ë men√º az alaprajz kiv√°laszt√°s√°hoz -->
<br><br>
<label for="tervvalaszto">V√°lassz alaprajzot:</label>
<select id="tervvalaszto" onchange="changePlan()">
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/01_bont%C3%A1si%20alaprajz.jpg">01 ‚Äì Bont√°si alaprajz</option>
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/02_b%C3%BAtorozott%20alaprajz.jpg">02 ‚Äì B√∫torozott alaprajz</option>
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/03_elektromos%20alaprajz.jpg">03 ‚Äì Elektromos alaprajz</option>
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/04_g%C3%A9p%C3%A9sz%20alaprajz.jpg">04 ‚Äì G√©p√©sz alaprajz</option>
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/05_%C3%A1lmennyezet%20alaprajz.jpg">05 ‚Äì √Ålmennyezet alaprajz</option>
  <option value="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/06_g%C3%A1zterv%20alaprajz.jpg">06 ‚Äì G√°zterv alaprajz</option>
</select>

<!-- Alaprajz + hotspotok -->
<div id="alaprajz-container">
  <img id="alaprajz" src="https://fuletlenfiu.github.io/szuglo_68_virtualis_seta/images/01_bontasi.jpg" alt="Alaprajz">

  <!-- Hotspotok -->
  <div class="hotspot" id="hs1" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/1.jpg"></div>
  <div class="hotspot" id="hs2" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/2.jpg"></div>
  <div class="hotspot" id="hs3" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/3.jpg"></div>
  <div class="hotspot" id="hs4" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/4.jpg"></div>
  <div class="hotspot" id="hs5" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/5.jpg"></div>
  <div class="hotspot" id="hs6" data-image="https://raw.githubusercontent.com/fuletlenfiu/szuglo_68_virtualis_seta/refs/heads/main/6.jpg"></div>
</div>

<h2>Panor√°mak√©p</h2>
<div id="panorama"></div>

<script>
  // üîπ Panorama bet√∂lt√©se
  function loadPanorama(image) {
    pannellum.viewer('panorama', {
      type: 'equirectangular',
      panorama: image,
      autoLoad: true,
      hfov: 120   // üîπ nagyobb alap l√°t√≥sz√∂g
    });
  }

  // üîπ Hotspot kattint√°s -> panor√°ma bet√∂lt√©s
  document.querySelectorAll('.hotspot').forEach(hs => {
    hs.addEventListener('click', () => {
      loadPanorama(hs.dataset.image);
    });
  });

  // üîπ Leg√∂rd√ºl≈ë men√º alaprajz v√°lt√°s
  function changePlan() {
    var select = document.getElementById("tervvalaszto");
    var chosenPlan = select.value;
    document.getElementById("alaprajz").src = chosenPlan;
  }

  // üîπ Admin k√≥d ellen≈ërz√©s
  let adminMode = false;
  function checkAdmin() {
    const code = document.getElementById("adminkod").value;
    if(code === "F√ºlike") {
      adminMode = true;
      document.getElementById("adminstatus").textContent = "Admin m√≥dban vagy!";
      document.querySelectorAll('.hotspot').forEach(hs => hs.classList.add('admin'));
    } else {
      adminMode = false;
      document.getElementById("adminstatus").textContent = "Helytelen k√≥d!";
      document.querySelectorAll('.hotspot').forEach(hs => hs.classList.remove('admin'));
    }
  }

  // üîπ Hotspot poz√≠ci√≥k bet√∂lt√©se localStorage-b≈ël
  function loadPositions() {
    const saved = localStorage.getItem("hotspotPositions");
    if (saved) {
      const positions = JSON.parse(saved);
      for (let id in positions) {
        const el = document.getElementById(id);
        if (el) {
          el.style.top = positions[id].top;
          el.style.left = positions[id].left;
        }
      }
    } else {
      // Kezd≈ë poz√≠ci√≥k
      document.getElementById("hs1").style.top="100px"; document.getElementById("hs1").style.left="150px";
      document.getElementById("hs2").style.top="200px"; document.getElementById("hs2").style.left="300px";
      document.getElementById("hs3").style.top="250px"; document.getElementById("hs3").style.left="400px";
      document.getElementById("hs4").style.top="120px"; document.getElementById("hs4").style.left="350px";
      document.getElementById("hs5").style.top="180px"; document.getElementById("hs5").style.left="500px";
      document.getElementById("hs6").style.top="300px"; document.getElementById("hs6").style.left="250px";
    }
  }

  // üîπ Hotspot poz√≠ci√≥k ment√©se localStorage-be
  function savePositions() {
    if(!adminMode) return; // csak admin menthet
    const positions = {};
    document.querySelectorAll('.hotspot').forEach(hs => {
      positions[hs.id] = {
        top: hs.style.top,
        left: hs.style.left
      };
    });
    localStorage.setItem("hotspotPositions", JSON.stringify(positions));
  }

  // üîπ Drag & Drop (csak admin m√≥dban)
  let active = null, offsetX, offsetY;

  document.querySelectorAll('.hotspot').forEach(hs => {
    hs.addEventListener('mousedown', e => {
      if(!adminMode) return;
      active = hs;
      offsetX = e.offsetX;
      offsetY = e.offsetY;
      hs.style.cursor = "grabbing";
    });
  });

  document.addEventListener('mousemove', e => {
    if (active && adminMode) {
      const container = document.getElementById('alaprajz-container');
      const rect = container.getBoundingClientRect();
      let x = e.clientX - rect.left - offsetX;
      let y = e.clientY - rect.top - offsetY;
      active.style.left = x + "px";
      active.style.top = y + "px";
    }
  });

  document.addEventListener('mouseup', () => {
    if (active && adminMode) {
      active.style.cursor = "grab";
      savePositions();
    }
    active = null;
  });

  // üîπ Indul√°skor bet√∂ltj√ºk a poz√≠ci√≥kat
  loadPositions();

</script>

</body>
</html>
